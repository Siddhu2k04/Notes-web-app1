<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Secure Notes App</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 1000px;
    margin: 20px auto;
    padding: 10px;
    background: #f2f2f2;
  }

  h1 {
    text-align: center;
    color: #333;
    margin-bottom: 20px;
  }

  .container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  input {
    padding: 10px;
    width: 100%;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 16px;
  }

  button {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover { opacity: 0.9; }

  /* Notes Grid */
  #notesList {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    grid-auto-rows: min-content;
    gap: 20px;
    margin-top: 20px;
  }

  .note-card {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
    word-wrap: break-word;
  }

  .note-card img {
    max-width: 100%;
    border-radius: 5px;
  }

  .file-preview {
    border: 1px solid #aaa;
    padding: 5px;
    background: #f9f9f9;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .timestamp {
    font-size: 0.8em;
    color: #666;
  }

  .note-actions {
    display: flex;
    justify-content: space-between;
    gap: 5px;
    flex-wrap: nowrap;
  }

  .view-btn { background: #3498db; color: white; flex:1; }
  .download-btn { background: #27ae60; color: white; flex:1; }
  .delete-btn { background: #e74c3c; color: white; flex:1; }

  .note-card h4 { margin: 0; word-wrap: break-word; overflow-wrap: break-word; }

</style>
</head>
<body>

    

<div class="container">
  <h1>Secure Notes</h1>
  <input type="text" id="title" placeholder="Enter Title">
  <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png">
  <button onclick="addNote()" style="background:#8e44ad;color:white;">Submit Note</button>

  <div id="notesList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCfUr14eVNLosBl13GBMGJc_GnnC5eXdhw",
  authDomain: "notes-1-71989.firebaseapp.com",
  projectId: "notes-1-71989",
  storageBucket: "notes-1-71989.appspot.com",
  messagingSenderId: "43784830040",
  appId: "1:43784830040:web:684eb93e1bbc0f34eade2d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const notesList = document.getElementById("notesList");

async function addNote() {
  const title = document.getElementById("title").value.trim();
  const fileInput = document.getElementById("fileInput");
  const file = fileInput.files[0];

  if (!title && !file) return alert("Add at least a title or a file!");

  let base64File = null, fileName = null, fileType = null;

  if (file) {
    const reader = new FileReader();
    reader.onload = async function () {
      base64File = reader.result;
      fileName = file.name;
      fileType = file.type;
      await saveNote(title, base64File, fileName, fileType);
    };
    reader.readAsDataURL(file);
  } else {
    await saveNote(title, null, null, null);
  }
}

async function saveNote(title, file, fileName, fileType) {
  try {
    await addDoc(collection(db, "notes"), {
      title,
      file,
      fileName,
      fileType,
      createdAt: serverTimestamp()
    });
    document.getElementById("title").value = "";
    document.getElementById("fileInput").value = "";
  } catch (err) {
    console.error("Upload failed:", err);
    alert("Failed to upload note. Check your Firestore rules!");
  }
}

function loadNotes() {
  const q = query(collection(db, "notes"), orderBy("createdAt", "desc"));
  onSnapshot(q, snapshot => {
    notesList.innerHTML = "";
    snapshot.forEach(docItem => {
      const data = docItem.data();
      const card = document.createElement("div");
      card.className = "note-card";

      if (data.title) {
        const titleEl = document.createElement("h4");
        titleEl.textContent = data.title;
        card.appendChild(titleEl);
      }

      const actions = document.createElement("div");
      actions.className = "note-actions";

      if (data.file) {
        const viewBtn = document.createElement("button");
        viewBtn.textContent = "View";
        viewBtn.className = "view-btn";
        viewBtn.onclick = () => window.open(data.file, "_blank");
        actions.appendChild(viewBtn);

        const downloadBtn = document.createElement("button");
        downloadBtn.textContent = "Download";
        downloadBtn.className = "download-btn";
        downloadBtn.onclick = () => {
          const a = document.createElement("a");
          a.href = data.file;
          a.download = data.fileName || "download";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        };
        actions.appendChild(downloadBtn);
      }

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.className = "delete-btn";
      deleteBtn.onclick = async () => {
        if (confirm("Delete this note?")) {
          await deleteDoc(doc(db, "notes", docItem.id));
        }
      };
      actions.appendChild(deleteBtn);

      if (data.file) {
  const ext = data.fileType || "";

  if (data.fileType.startsWith("image/")) {
    // Show image preview
    const img = document.createElement("img");
    img.src = data.file;
    img.alt = data.title || "image";
    card.appendChild(img);

  } else if ([
      "application/pdf",
      "application/msword",
      "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
      "application/vnd.ms-powerpoint",
      "application/vnd.openxmlformats-officedocument.presentationml.presentation",
      "application/vnd.ms-excel",
      "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
      "text/plain"
    ].includes(ext)) {
    // Show preview for PDF, Word, PPT, Excel, and Text
    const filePreview = document.createElement("div");
    filePreview.className = "file-preview";
    filePreview.textContent = `ðŸ“„ ${data.fileName || "File"}`;
    card.appendChild(filePreview);
  }
}


      card.appendChild(actions);

      const timeEl = document.createElement("div");
      timeEl.className = "timestamp";
      timeEl.textContent = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString() : "";
      card.appendChild(timeEl);

      notesList.appendChild(card);
    });
  });
}

window.addNote = addNote;
window.loadNotes = loadNotes;
loadNotes();


</script>

</body>
</html>
